# 🔍 OpenAI 公益站检测工具

一个用于测试 OpenAI 兼容接口功能的 Python 工具。可以帮助您快速检测公益站或第三方 API 是否支持各种 OpenAI 功能。

## ✨ 功能特性

- **📋 模型列表检测** - 获取并显示接口支持的所有模型
- **💬 基础对话检测** - 测试基本的 Chat Completion 功能
- **🌊 Stream 模式检测** - 测试接口是否支持流式输出，区分真流式和伪流式
- **🔧 工具调用检测** - 测试接口是否支持 Function Calling / Tools

## 📦 安装

### 1. 克隆项目

```bash
git clone https://github.com/PaddyDu/openai-tester.git
cd openai-tester
```

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

或者手动安装：

```bash
pip install requests rich
```

## 🚀 使用方法

### 运行程序

```bash
python openai_tester.py
```

### 输入信息

程序会提示您输入：

1. **API Base URL** - API 的基础地址
   - 例如：`https://api.openai.com/v1`
   - 或公益站地址：`https://your-proxy.com/v1`

2. **API Key** - 您的 API 密钥

### 循环测试模式

- 测试完成后自动返回模型列表，可以继续测试其他模型
- 输入 `0` 退出程序，显示所有测试过的模型对比报告

### 示例输出

```
╭─────────────────────────────────────╮
│ 🔍 OpenAI 公益站检测工具            │
│ 测试 OpenAI 兼容接口的各种功能      │
╰─────────────────────────────────────╯

请输入 API 信息:
API Base URL (如 https://api.openai.com/v1): https://api.example.com/v1
API Key: sk-xxxxx

开始测试...
==================================================

📋 测试模型列表...
✅ 成功获取 10 个模型

请选择要测试的模型:
💬 对话模型:
  1. gpt-3.5-turbo
  2. gpt-4
  ...

🚀 开始使用模型 [gpt-4] 进行功能测试...

💬 测试基础对话...
✅ 对话成功

🌊 测试 Stream 流式输出...
✅ 真正的流式输出! 收到 25 个数据块

🔧 测试工具调用 (Function Calling)...
✅ 工具调用支持!

╭───────────────────────────────╮
│      📊 测试结果摘要          │
│      测试模型: gpt-4          │
╰───────────────────────────────╯
┌──────────────┬────────┬──────────┬─────────────────┐
│ 测试项目     │ 状态   │ 响应时间 │ 备注            │
├──────────────┼────────┼──────────┼─────────────────┤
│ 模型列表     │ ✅ 通过│ 0.5s     │ 10 个模型       │
│ 基础对话     │ ✅ 通过│ 2.1s     │ gpt-4           │
│ Stream 模式  │ ✅ 通过│ 3.2s     │ 25 块 (真正流式)│
│ 工具调用     │ ✅ 通过│ 2.8s     │ 已调用          │
└──────────────┴────────┴──────────┴─────────────────┘

总计: 4/4 项测试通过
```

## 📝 测试项目说明

| 测试项目 | 说明 |
|---------|------|
| 模型列表 | 调用 `/models` 接口获取支持的模型列表 |
| 基础对话 | 调用 `/chat/completions` 进行简单对话测试 |
| Stream 模式 | 测试流式输出，检查是否能正确接收 SSE 数据流，区分真流式和伪流式 |
| 工具调用 | 测试 Function Calling 功能，发送带工具定义的请求 |

### Stream 模式质量评估

| 质量等级 | 说明 |
|---------|------|
| 真正流式 (excellent) | 数据块之间有明显时间间隔，首字节时间短 |
| 流式支持 (good) | 能收到多个数据块 |
| 伪流式 (poor) | 数据块太少，可能是一次性返回 |
| 不支持 | API 返回空流式响应 |

## ⚠️ 注意事项

1. 确保 API Base URL 格式正确，通常以 `/v1` 结尾
2. 某些公益站可能不支持所有功能，测试失败不代表接口完全不可用
3. 工具调用功能需要模型支持（如 GPT-3.5-turbo、GPT-4、Claude 等）
4. 不同模型对 Stream 的支持程度可能不同

## 🔧 自定义测试

您可以在代码中修改测试参数，例如：

```python
# 指定特定模型进行测试
tester.test_chat_completion(model="gpt-4")
tester.test_stream_mode(model="gpt-3.5-turbo")
```

## 📄 许可证

MIT License

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！
